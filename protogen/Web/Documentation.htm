<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <title>Documenting the Confirmation Protocol</title>
</head>
<body>

    <h1>
        Building the Protocol documentation</h1>
    <p>
        ProtoGen can generate documentation as well as code. Currently two document 
        formats are supported:</p>
    <ul>
        <li>HTML</li>
        <li>XML2RFC, the markup language used by the IETF</li>
    </ul>
    <p>
        Since the protocol description only describes what the protocol does and not why 
        it does it, the documentation generated by ProtoGen is referfence material with 
        descriptive annotations provided by the developer.
    </p>
    <p>
        We could simply copy and past the automatically generated text into the right 
        part of the specification but doing this for multiple design iterations gets old 
        very fast. Although XML does in thery provide mechanisms that allow a document 
        to reference external documents these do not work very well with the hosted Web 
        tools used to convert the XML documents into the publishing format used by the 
        IETF.</p>
    <p>
        The best approach is to use a tool to merge the source text and the generated 
        documentation to produce a single file. this may be done in many different ways 
        but the one I use is a tool called HTML2RFC which uses XML processor directives 
        to specify the point(s) at which another document is to be inserted (among other 
        features).</p>
    <p>
        To use HTML2RFC to merge documents we insert the following preprocessor 
        directive at the point where we want another file to be inserted:</p>
    <pre>&lt;?include xml="Confirmation.xml" ?&gt;</pre>
    <p>
        HTML2RFC is run from the command line by specifying the input and output files:</p>
    <pre>html2rfc hallambaker-owcp.xml draft-hallambaker-owcp.xml</pre>
    <p>
        Using HTML2RFC to merge the documentation does have a few non-obvious catches 
        however:</p>
    <ul>
        <li>HTML2RFC attempts to validate the XML file before merging the documents. So any 
            DTD files referenced in the document must be accessible to the tool when it 
            runs.</li>
        <li>If an automated build tool is used, the document merge must be performed after 
            all the generated files have been updated including any example code. This 
            usually means that the documentation merge should be the last element in the 
            build process.</li>
    </ul>
    <p>
        At this point the reference documentation is not very useful because the 
        protocol description doesn&#39;t contain many Description declarations to describe 
        the use of the protocol elements. So the next step in our protocol development 
        is to add these in.</p>
    <p>
        Another feature our documentation is currently lacking is illustrative examples 
        of protocol messages. We will show how to generate these after we have 
        illustrative client and server code to generate the protocol messages.</p>

</body>
</html>
